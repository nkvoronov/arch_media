#!/bin/sh

[ -r /etc/conf.d/tvheadend ] && . /etc/conf.d/tvheadend

[ "$TVH_ENABLED" = "1" ] || exit 0

echo  "Starting HTS TVHeadend server ..."

ARGS="-f -p /run/tvheadend.pid -C"
[ -z "$TVH_USER"      ] || ARGS="$ARGS -u $TVH_USER"
[ -z "$TVH_GROUP"     ] || ARGS="$ARGS -g $TVH_GROUP"
[ -z "$TVH_CONF_DIR"  ] || ARGS="$ARGS -c $TVH_CONF_DIR"
[ -z "$TVH_ADAPTERS"  ] || ARGS="$ARGS -a $TVH_ADAPTERS"
[ "$TVH_IPV6" = "1"   ] && ARGS="$ARGS -6"
[ -z "$TVH_HTTP_PORT" ] || ARGS="$ARGS --http_port $TVH_HTTP_PORT"
[ -z "$TVH_HTTP_ROOT" ] || ARGS="$ARGS --http_root $TVH_HTTP_ROOT"
[ -z "$TVH_HTSP_PORT" ] || ARGS="$ARGS --htsp_port $TVH_HTSP_PORT"
[ "$TVH_DEBUG" = "1"  ] && ARGS="$ARGS -s"
[ -z "$TVH_ARGS"      ] || ARGS="$ARGS $TVH_ARGS"

if [ "$TVH_PRELOAD_CAPMT_CA" = "1" ]; then
  LD_PRELOAD="/usr/lib/capmt_ca.so $LD_PRELOAD" exec tvheadend $ARGS
else
  exec tvheadend $ARGS
fi