pkgname=projectm-git
_gitname='source-git'
_verpkg=3.1.1rc4
pkgver=3.1.1rc4_ge85bf0386
pkgrel=1
_commit=e85bf0386d3ba7f6e9122462c3fef02ebd536057
conflicts=('projectm')
provides=('projectm')
pkgdesc="Music visualizer which uses 3D accelerated iterative image based rendering (git version)"
arch=('x86_64' 'i686')
url='https://github.com/projectM-visualizer/projectm'
license=('LGPL')
depends=('sdl2' 'libxext' 'glm')
source=("${_gitname}::git+https://github.com/projectM-visualizer/projectm.git#commit=${_commit}")
sha256sums=('SKIP')

pkgver() {
  cd "${srcdir}/${_gitname}"
  _git=`git rev-parse --short HEAD`
  printf "%s_%s" "$_verpkg" "g$_git"
}

build() {
  cd "${srcdir}/${_gitname}"
  ./autogen.sh
  ./configure --prefix=/usr --enable-sdl
  make
}

package() {
  cd "${srcdir}/${_gitname}"
  DESTDIR="$pkgdir" make install
  DESTDIR="$pkgdir" install -Dm644 "${srcdir}/${_gitname}/src/COPYING" "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
}
